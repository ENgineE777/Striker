#import "Mission"
#import "Main"

class Mission1 : Mission
{
    array<Marker> dangerZone;
    EnemyPool@ radars;
    array<Enemy@> tanks;
    Marker buildingEntrance;
    Marker helipad;
    array<Enemy@> chopers;
    Marker delverPad;
    Main@ main;

    void OnInit()
    {
        for (int i = 0; i<main.enemies.get_length();i++)
        {
            if (main.enemies[i].enemy_name == "Radar")
            {
                @radars = @main.enemies[i];
                break;
            }
        }
    }

    bool IsCompleted()
    {
        return false;
    }

    void InternalUpdate(float dt) override
    {
        if (curObjective == 0)
        {
            bool danger_zone = false;

            for (int i = 0; i < dangerZone.get_length(); i++)
            {
                Vector3 pos = dangerZone[i].transform.GetPos();
                Vector2 dir = Vector2(main.heli_pos.x, main.heli_pos.z) - Vector2(pos.x, pos.z);

                if (dir.Length() < dangerZone[i].radius)
                {
                    danger_zone = true;
                }
            }

            if (danger_zone)
            {
                core.render.DebugText(10, 30, "Danger Zone");
            }

            int radars_count = 0;

            for (int i = 0; i < radars.enemies.get_length(); i++)
            {
                if (radars.enemies[i].hp > 0)
                {
                    Matrix mat = radars.enemies[i].mesh.GetTransform();
                    ShowMarker(mat.GetPos(), i);

                    radars_count++;
                }
            }

            if (radars_count == 0)
            {
                curObjective++;
            }
        }
        else
        if (curObjective == 1)
        {
            ShowMarker(helipad.transform.GetPos(), 0);
        }
    }

    void DrawObjective(float dt)
    {

    }

    void DrawMarkers(float dt)
    {

    }
}